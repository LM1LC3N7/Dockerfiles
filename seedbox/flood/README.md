# Flood

This is a web UI for rTorrent available on GitHub: [jfurrow/flood](https://github.com/jfurrow/flood).


## Build

* **Base image:** Distroless
* **`flood` version:** Last version available on the GitHub project
* **Multi-stage:** Yes
* **Supervisor:** No

Command:

```bash
docker build -t lmilcent/flood:distroless .
```


## Image details

* **Based on:** Distroless
* **Layers:** 6
* **Size:** 363 Mio
* **Startup time:** 10 seconds
* **Auto-restart:** yes
* **Time Synchronization** no
* **Hardware limitations:** 0.5 CPU, 150 Mio RAM, no SWAP
* **Low privileges** no
* **Capabilities limitations:** `dac_override`

This image is using the `proxy` network in order to contact the `traefik` container (a proxy service) and is also connected to `rtorrent-backend` to contact rTorrent service.



## Start

### 1. Import Secrets
Import all secrets stored as system variables into `SECRET.env` before starting the container.

`SECRET.env` example:

```bash
declare -x FLOOD_SECRET="long-random-password"
```

To import all secrets on the current bash:

```bash
. SECRET.env
```


### 2. Start the container
Startup command, using the `appDeploy/startContainer` script:

```bash
startContainer flood.cfg
```

Command generated by the script:

```bash
docker create \
  --label "traefik.enable=true" \
  --label "traefik.frontend.rule=Host:sub.domain.com" \
  --label "traefik.port=3000" \
  --label "traefik.docker.network=proxy" \
  --label "traefik.backend=rTorrent" \
  --label "traefik.frontend.entryPoints=http,https" \
  --label "traefik.frontend.redirect.entryPoint=https" \
  --label "traefik.protocol=http" \
  --detach \
  --name="flood" \
  --restart=unless-stopped \
  --stop-timeout=5 \
  --volume rtorrent-flood-db:/app/flood/flood-db:rw \
  --cpus=0.5 \
  --memory=150m \
  --memory-swap=150m \
  --memory-swappiness=0 \
  --env-file /home/lmilcent/docker/Dockerfiles/flood/env.cfg \
  --network=proxy \
  --cap-drop=all \
  --cap-add=dac_override \
  lmilcent/flood:distroless
```
