# SSLH

Applicative protocol multiplexer ([sslh](https://github.com/yrutschle/sslh)) usefull to use the 443 port with multiple protocols: `https` / `openvpn` / `ssh` / `shadowsocks`.

## Build

* **Base image:** Alpine linux
* **`sslh` version:** Last version available on [edge testing alpine repository](http://dl-3.alpinelinux.org/alpine/edge/testing)
* **Multi-stage:** No
* **Supervisor:** Yes, [`s6-overlay`](https://github.com/just-containers/s6-overlay#goal)

Command:

```bash
docker build -t lmilcent/sslh:alpine .
```


## Image details

* **Based on:** Alpine Linux
* **Layers:** 3
* **Size:** 16,2 Mio
* **Startup time:** 10 seconds
* **Auto-restart:** yes
* **Time Synchronization** yes, with host
* **Hardware limitations:** 0.5 CPU, 10 Mio RAM, no SWAP
* **Low privileges** yes, running using `app` user
* **Capabilities limitations:** `setuid`, `setgid`, `net_bind_service`, `setfcap`

This image is using the `proxy` network in order to contact the `traefik` container (a proxy service).

Startup command, using the `appDeploy/startContainer` script:

```bash
startContainer sslh.cfg
```

Command generated by the script:

```bash
docker run \
  --tty \
  --detach \
  --name="sslh" \
  --restart=unless-stopped \
  --stop-timeout=10 \
  --volume /etc/localtime:/etc/localtime:ro \
  --cpus=0.5 \
  --memory=10m \
  --memory-swap=10m \
  --memory-swappiness=0 \
  --env-file /home/lmilcent/docker/Dockerfiles/sslh/env.cfg \
  --publish 443:443/tcp \
  --network=proxy \
  --cap-drop=all \
  --cap-add=setgid \
  --cap-add=setuid \
  --cap-add=net_bind_service \
  --cap-add=setfcap \
  lmilcent/sslh:alpine
```

**env.cfg**

```bash
# Listening port / host
LISTEN_IP=0.0.0.0
LISTEN_PORT=443

# Use WAN address for server SSH
SSH_HOST=domain.com
SSH_PORT=22

# OpenVPN container name
OPENVPN_HOST=pritunl
OPENVPN_PORT=1194

# Traefik container name
HTTPS_HOST=traefik
HTTPS_PORT=443

# No Shadow Socks for now.
SHADOWSOCKS_HOST=localhost
SHADOWSOCKS_PORT=8388
```
